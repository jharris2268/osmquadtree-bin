scale: 1
metatile: 2
name: "OpenStreetMap Carto"
description: "A faithful reimplementation of the standard OpenStreetMap style"
bounds: &world
  - -180
  - -85.05112877980659
  - 180
  - 85.05112877980659
center:
  - 0
  - 0
  - 4
format: "png"
interactivity: false
minzoom: 0
maxzoom: 22
srs: "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over"

# Various parts to be included later on
_parts:
  # Extents are used for tilemill, and don't actually make it to the generated XML
  extents: &extents
    extent: *world
    srs-name: "900913"
    srs: "+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0.0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs +over"
  extents84: &extents84
    extent: *world
    srs-name: "WGS84"
    srs: "+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs"
  postds: &postds
    type: "python"
    factory: "osmquadtreeutils.postds:PostDS"

Stylesheet:
  - "style.mss"
  - "shapefiles.mss"
  - "landcover.mss"
  - "water.mss"
  - "water-features.mss"
  - "roads.mss"
  - "power.mss"
  - "citywalls.mss"
  - "placenames.mss"
  - "buildings.mss"
  - "stations.mss"
  - "amenity-points.mss"
  - "ferry-routes.mss"
  - "aerialways.mss"
  - "admin.mss"
  - "addressing.mss"
Layer:
  - id: "world"
    name: "world"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      file: "data/simplified-land-polygons-complete-3857/simplified_land_polygons.shp"
      type: "shape"
    advanced: {}
    properties:
      maxzoom: 9
  - id: "coast-poly"
    name: "coast-poly"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      file: "data/land-polygons-split-3857/land_polygons.shp"
      type: "shape"
    properties:
      minzoom: 10
    advanced: {}
  - id: "builtup"
    name: "builtup"
    geometry: "polygon"
    class: ""
    extent: *world
    srs-name: "mercator"
    srs: "+proj=merc +datum=WGS84 +over"
    Datasource:
      file: "data/world_boundaries/builtup_area.shp"
      type: "shape"
    properties:
      minzoom: 8
      maxzoom: 9
    advanced: {}
  - id: "necountries"
    name: "necountries"
    class: ""
    geometry: "linestring"
    <<: *extents84
    Datasource:
      file: "data/ne_110m_admin_0_boundary_lines_land/ne_110m_admin_0_boundary_lines_land.shp"
      type: "shape"
    properties:
      minzoom: 1
      maxzoom: 3
    advanced: {}
  - id: "landcover-low-zoom"
    name: "landcover-low-zoom"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 4
      table: |-
        (SELECT
            way, name, way_pixels,
            COALESCE(landuse, "natural") AS feature
          FROM (SELECT
              way, COALESCE(name, '') AS name,
              ('landuse_' || (CASE WHEN landuse IN ('forest') THEN landuse ELSE NULL END)) AS landuse,
              ('natural_' || (CASE WHEN "natural" IN ('wood', 'sand', 'scree', 'shingle', 'bare_rock') THEN "natural" ELSE NULL END)) AS "natural",
              way_area/(!pixel_width!*!pixel_height!) AS way_pixels
            FROM planet_osm_polygon
            WHERE (landuse IN ('forest')
              OR "natural" IN ('wood', 'sand', 'scree', 'shingle', 'bare_rock'))
              AND way_area/(!pixel_width!*!pixel_height!) > 0.01
              AND building IS NULL
            ORDER BY z_order, way_area DESC
          ) AS features
        ) AS landcover_low_zoom
    properties:
      maxzoom: 9
    advanced: {}
  - id: "landcover"
    name: "landcover"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 5
      table: |-
        (SELECT
            way, name, religion, way_pixels,
            COALESCE(aeroway, amenity, landuse, leisure, military, "natural", power, tourism, highway, railway) AS feature 
          FROM (SELECT 
              way, COALESCE(name, '') AS name, 
              ('aeroway_' || (CASE WHEN aeroway IN ('apron', 'aerodrome') THEN aeroway ELSE NULL END)) AS aeroway,
              ('amenity_' || (CASE WHEN amenity IN ('parking', 'university', 'college', 'school', 'hospital', 'kindergarten', 'grave_yard', 'prison', 'place_of_worship') THEN amenity ELSE NULL END)) AS amenity,
              ('landuse_' || (CASE WHEN landuse IN ('quarry', 'vineyard', 'orchard', 'cemetery', 'residential', 'garages', 'meadow', 'grass', 'allotments', 'forest', 'farmyard', 'farm', 'farmland', 'recreation_ground', 'conservation', 'village_green', 'retail', 'industrial', 'railway', 'commercial', 'brownfield', 'landfill', 'construction') THEN landuse ELSE NULL END)) AS landuse,
              ('leisure_' || (CASE WHEN leisure IN ('swimming_pool', 'playground', 'park', 'recreation_ground', 'common', 'garden', 'golf_course', 'miniature_golf', 'picnic_table', 'sports_centre', 'stadium', 'pitch', 'track') THEN leisure ELSE NULL END)) AS leisure,
              ('military_' || (CASE WHEN military IN ('danger_area') THEN military ELSE NULL END)) AS military,
              ('natural_' || (CASE WHEN "natural" IN ('beach', 'heath', 'mud', 'grassland', 'wood', 'sand', 'scree', 'shingle', 'bare_rock', 'scrub') THEN "natural" ELSE NULL END)) AS "natural",
              ('power_' || (CASE WHEN power IN ('station', 'sub_station', 'substation', 'generator') THEN power ELSE NULL END)) AS power,
              ('tourism_' || (CASE WHEN tourism IN ('attraction', 'camp_site', 'caravan_site', 'picnic_site', 'zoo') THEN tourism ELSE NULL END)) AS tourism,
              ('highway_' || (CASE WHEN highway IN ('services', 'rest_area') THEN highway ELSE NULL END)) AS highway,
              ('railway_' || (CASE WHEN railway = 'station' THEN railway ELSE NULL END)) AS railway,
              CASE WHEN religion IN ('christian', 'jewish') THEN religion ELSE 'INT-generic'::text END AS religion,
              way_area/(!pixel_width!*!pixel_height!) AS way_pixels
            FROM planet_osm_polygon
            WHERE (landuse IS NOT NULL
              OR leisure IS NOT NULL
              OR aeroway IN ('apron', 'aerodrome')
              OR amenity IN ('parking', 'university', 'college', 'school', 'hospital', 'kindergarten', 'grave_yard', 'place_of_worship', 'prison')
              OR military IN ('danger_area')
              OR "natural" IN ('beach', 'heath', 'mud', 'grassland', 'wood', 'sand', 'scree', 'shingle', 'bare_rock', 'scrub')
              OR power IN ('station', 'sub_station', 'substation', 'generator')
              OR tourism IN ('attraction', 'camp_site', 'caravan_site', 'picnic_site', 'zoo')
              OR highway IN ('services', 'rest_area')
              OR railway = 'station')
              AND way_area/(!pixel_width!*!pixel_height!) > 0.01
            ORDER BY z_order, way_area DESC
          ) AS landcover
        ) AS features
    properties:
      minzoom: 10
    advanced: {}
  - id: "landcover-line"
    name: "landcover-line"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 6
      table: |-
        (SELECT
            way
          FROM planet_osm_line
          WHERE man_made = 'cutline'
        ) AS landcover_line
    advanced: {}
    properties:
      minzoom: 14
  - id: "water-lines-casing"
    name: "water-lines-casing"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 7
      table: |-
        (SELECT 
            way, waterway, intermittent,
            CASE WHEN tunnel IN ('yes', 'culvert') THEN 'yes' ELSE 'no' END AS int_tunnel
          FROM planet_osm_line
          WHERE waterway IN ('stream', 'drain', 'ditch')
        ) AS water_lines_casing
    properties:
      minzoom: 13
    advanced: {}
  - id: "water-lines-low-zoom"
    name: "water-lines-low-zoom"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 8
      table: |-
        (SELECT way, waterway
          FROM planet_osm_line
          WHERE waterway = 'river'
        ) AS water_lines_low_zoom
    properties:
      minzoom: 8
      maxzoom: 11
    advanced: {}
  - id: "water-areas"
    name: "water-areas"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 9
      table: |-
        (SELECT
            way, "natural", waterway, landuse, name, way_area/(!pixel_width!*!pixel_height!) AS way_pixels
          FROM planet_osm_polygon
          WHERE
            (waterway IN ('dock', 'riverbank', 'canal')
              OR landuse IN ('reservoir', 'basin')
              OR "natural" IN ('water', 'glacier', 'mud'))
            AND building IS NULL
            AND way_area/(!pixel_width!*!pixel_height!) > 0.01
          ORDER BY z_order, way_area DESC
        ) AS water_areas
    properties:
      minzoom: 4
    advanced: {}
  - id: "water-areas-overlay"
    name: "water-areas-overlay"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 10
      table: |-
        (SELECT
            way, "natural"
          FROM planet_osm_polygon
          WHERE "natural" IN ('marsh', 'wetland') AND building IS NULL
          ORDER BY z_order, way_area DESC
        ) AS water_areas_overlay
    properties:
      minzoom: 10
    advanced: {}
  - id: "water-lines"
    name: "water-lines"
    class: "water-lines"
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 11
      table: |-
        (SELECT 
            way, waterway, lock, name, intermittent,
            CASE WHEN tunnel IN ('yes', 'culvert') THEN 'yes' ELSE 'no' END AS int_tunnel,
            'no' AS bridge
          FROM planet_osm_line
          WHERE waterway IN ('weir', 'river', 'canal', 'derelict_canal', 'stream', 'drain', 'ditch', 'wadi')
            AND (bridge IS NULL OR bridge NOT IN ('yes', 'aqueduct'))
          ORDER BY z_order
        ) AS water_lines
    properties:
      minzoom: 12
    advanced: {}
  - id: "dam"
    name: "dam"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 12
      table: |-
        (SELECT way, name
          FROM planet_osm_line
          WHERE waterway = 'dam'
        ) AS dam
    properties:
      minzoom: 13
    advanced: {}
  - id: "marinas-area"
    name: "marinas-area"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 13
      table: |-
        (SELECT
            way
          FROM planet_osm_polygon
          WHERE leisure = 'marina'
        ) AS marinas_area
    properties:
      minzoom: 14
    advanced: {}
  - id: "piers-area"
    name: "piers-area"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 14
      table: |-
        (SELECT
            way, man_made
          FROM planet_osm_polygon
          WHERE man_made IN ('pier', 'breakwater', 'groyne')
        ) AS piers_area
    properties:
      minzoom: 12
    advanced: {}
  - id: "piers"
    name: "piers"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 15
      table: |-
        (SELECT
            way, man_made
          FROM planet_osm_line
          WHERE man_made IN ('pier', 'breakwater', 'groyne')
        ) AS piers
    properties:
      minzoom: 12
    advanced: {}
  - id: "locks"
    name: "locks"
    class: ""
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 16
      table: |-
        (SELECT
            way, waterway
          FROM planet_osm_point
          WHERE waterway = 'lock_gate'
        ) AS locks
    properties:
      minzoom: 17
    advanced: {}
  - id: "buildings"
    name: "buildings"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 17
      table: |-
        (SELECT
            way, building
          FROM planet_osm_polygon
          WHERE (building IS NOT NULL)
            AND building != 'no'
          ORDER BY z_order, way_area DESC
        ) AS buildings
    properties:
      minzoom: 12
    advanced: {}
  - id: "buildings-major"
    name: "buildings-major"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 18
      table: |-
        (SELECT way, building, amenity, aeroway
          FROM planet_osm_polygon
          WHERE (building IS NOT NULL)
            AND building != 'no'
            AND (aeroway = 'terminal' OR amenity = 'place_of_worship')
          ORDER BY z_order,way_area DESC)
        AS buildings_major
    properties:
      minzoom: 12
    advanced: {}
  - id: "tunnels"
    name: "tunnels"
    class: "tunnels-fill tunnels-casing access directions"
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 19
      table: |-
        (SELECT * FROM
          (
            (SELECT way,feature,horse,foot,bicycle,tracktype,access,construction,service,oneway,link,layernotnull,prio FROM
                (SELECT way, 
                    ('highway_' || (CASE WHEN substr(highway, length(highway)-3, 4) = 'link' THEN substr(highway, 0, length(highway)-4) ELSE highway END)) AS feature,
                    horse, foot, bicycle, tracktype,
                    CASE WHEN access IN ('destination') THEN 'destination' WHEN access IN ('no', 'private') THEN 'no' ELSE NULL END AS access, construction,
                    CASE WHEN service IN ('parking_aisle', 'drive-through', 'driveway') THEN 'INT-minor' ELSE 'INT-normal' END AS service,
                    CASE WHEN oneway IN ('yes', '-1') THEN oneway ELSE NULL END AS oneway,
                    CASE WHEN substr(highway, length(highway)-3, 4) = 'link' THEN 'yes' ELSE 'no' END AS link,
                    makeinteger(layer) AS layernotnull
                  FROM planet_osm_line
                    WHERE (tunnel = 'yes' OR tunnel = 'building_passage' OR covered = 'yes')
                ) as a
                JOIN (VALUES
                  ('highway_motorway','no',380),
                  ('highway_trunk','no',370),
                  ('highway_primary','no',360),
                  ('highway_secondary','no',350),
                  ('highway_tertiary','no',340),
                  ('highway_residential','no',330),
                  ('highway_unclassified','no',330),
                  ('highway_road','no',330),
                  ('highway_living_street','no',320),
                  ('highway_pedestrian','no',310),
                  ('highway_raceway','no',300),
                  ('highway_motorway','yes',240),
                  ('highway_trunk','yes',230),
                  ('highway_primary','yes',220),
                  ('highway_secondary','yes',210),
                  ('highway_tertiary','yes',200),
                  ('highway_service','no',150),
                  ('highway_track','no',110),
                  ('highway_path','no',100),
                  ('highway_footway','no',100),
                  ('highway_bridleway','no',100),
                  ('highway_cycleway','no',100),
                  ('highway_steps','no',100),
                  ('highway_platform','no',90),
                  ('highway_proposed','no',20),
                  ('highway_construction','no',10)
                ) AS ordertable (feature, link, prio)
                  USING (feature,link)
            )
            UNION ALL
            (SELECT way,feature,horse,foot,bicycle,tracktype,access,construction,service,oneway,link,layernotnull,prio FROM
                    (SELECT way, 
                        COALESCE(('railway_' ||(CASE WHEN railway = 'preserved' AND service IN ('spur', 'siding', 'yard') THEN 'INT-preserved-ssy' WHEN (railway = 'rail' AND service IN ('spur', 'siding', 'yard')) THEN 'INT-spur-siding-yard' ELSE railway end)), ('aeroway_' || aeroway)) AS feature,
                        horse, foot, bicycle, tracktype,
                        CASE WHEN access IN ('destination') THEN 'destination' WHEN access IN ('no', 'private') THEN 'no' ELSE NULL END AS access,
                        construction, CASE WHEN service IN ('parking_aisle', 'drive-through', 'driveway') THEN 'INT-minor' ELSE 'INT-normal' END AS service,
                        NULL AS oneway, 'no' AS link,
                        makeinteger(layer) AS layernotnull
                
                  FROM planet_osm_line
                    WHERE (tunnel = 'yes' OR tunnel = 'building_passage' OR covered = 'yes')
                ) as c
                JOIN (VALUES
                  ('railway_rail', 430),
                  ('railway_spur', 430),
                  ('railway_siding', 430),('railway_INT-spur-siding-yard',430),
                  ('railway_subway', 420),
                  ('railway_narrow_gauge', 420),
                  ('railway_light_rail', 420),
                  ('railway_preserved', 420),
                  ('railway_funicular', 420),
                  ('railway_monorail', 420),
                  ('railway_miniature', 420),
                  ('railway_turntable', 420),
                  ('railway_tram', 410),
                  ('railway_disused', 400),
                  ('railway_construction', 400),
                  ('aeroway_runway', 60),
                  ('aeroway_taxiway', 50),
                  ('railway_platform', 90)
                ) AS ordertable (feature, prio)
                  USING (feature)
            )
             
          
          ) as features ORDER BY layernotnull,prio,case when access in ('no', 'private') then 0 when access in ('destination') then 1 else 2 end
        ) AS tunnels
    properties:
      group-by: "layernotnull"
      minzoom: 10
    advanced: {}
  - id: "citywalls"
    name: "citywalls"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 20
      table: |-
        (SELECT
            way
          FROM planet_osm_line
          WHERE historic = 'citywalls')
        AS citywalls
    advanced: {}
  - id: "castlewalls"
    name: "castlewalls"
    class: "castlewalls"
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 21
      table: |-
        (SELECT
            way
          FROM planet_osm_line
          WHERE historic = 'castle_walls'
        ) AS castlewalls
    properties:
      minzoom: 14
    advanced: {}
  - id: "castlewalls-poly"
    name: "castlewalls-poly"
    class: "castlewalls"
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 22
      table: |-
        (SELECT
            way
          FROM planet_osm_polygon
          WHERE historic = 'castle_walls'
        ) AS castlewalls_poly
    properties:
      minzoom: 14
    advanced: {}
  - id: "landuse-overlay"
    name: "landuse-overlay"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 23
      table: |-
        (SELECT
            way, landuse, leisure
          FROM planet_osm_polygon
          WHERE (landuse = 'military') AND building IS NULL
        ) AS landuse_overlay
    properties:
      minzoom: 10
    advanced: {}
  - id: "line-barriers"
    name: "line-barriers"
    class: "barriers"
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 24
      table: |-
        (SELECT
            way, barrier
          FROM planet_osm_line
          WHERE barrier IS NOT NULL
        ) AS line_barriers
    properties:
      minzoom: 16
    advanced: {}
  - id: "cliffs"
    name: "cliffs"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 25
      table: |-
        (SELECT
            way, "natural", man_made
          FROM planet_osm_line
          WHERE "natural" = 'cliff' OR man_made = 'embankment'
        ) AS cliffs
    properties:
      minzoom: 13
    advanced: {}
  - id: "area-barriers"
    name: "area-barriers"
    class: "barriers"
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 26
      table: |-
        (SELECT
            way, barrier
          FROM planet_osm_polygon
          WHERE barrier IS NOT NULL
        ) AS area_barriers
    properties:
      minzoom: 16
    advanced: {}
  - id: "ferry-routes"
    name: "ferry-routes"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 27
      table: |-
        (SELECT
            way
          FROM planet_osm_line
          WHERE route = 'ferry'
        ) AS ferry_routes
    properties:
      minzoom: 7
    advanced: {}
  - id: "turning-circle-casing"
    name: "turning-circle-casing"
    class: ""
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 28
      table: |-
        ( SELECT way,    parent_highway AS int_tc_type,
            CASE WHEN service IN ('parking_aisle', 'drive-through', 'driveway') THEN 'INT-minor' ELSE 'INT-normal' END AS int_tc_service
          FROM planet_osm_point 
          WHERE highway = 'turning_circle' OR highway = 'turning_loop')
        AS turning_circle_casing
    properties:
      minzoom: 15
    advanced: {}
  - id: "highway-area-casing"
    name: "highway-area-casing"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 29
      table: |-
        (SELECT
            way,
            COALESCE((
              'highway_' || (CASE WHEN highway IN ('residential', 'unclassified', 'pedestrian', 'service', 'footway', 'cycleway', 'track', 'path', 'platform') THEN highway ELSE NULL END)),
              ('railway_' || (CASE WHEN railway IN ('platform') THEN railway ELSE NULL END))
            ) AS feature
          FROM planet_osm_polygon
          WHERE highway IN ('residential', 'unclassified', 'pedestrian', 'service', 'footway', 'track', 'path', 'platform')
            OR railway IN ('platform')
          ORDER BY z_order, way_area DESC
        ) AS highway_area_casing
    properties:
      minzoom: 14
    advanced: {}
  - name: "roads-casing"
    id: "roads-casing"
    class: "roads-casing"
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 30
      table: |-
        (SELECT * FROM
          (
            (SELECT way,feature,horse,foot,bicycle,tracktype,access,construction,service,oneway,link,layernotnull,prio FROM
                (SELECT way, 
                    ('highway_' || (CASE WHEN substr(highway, length(highway)-3, 4) = 'link' THEN substr(highway, 0, length(highway)-4) ELSE highway END)) AS feature,
                    horse, foot, bicycle, tracktype,
                    CASE WHEN access IN ('destination') THEN 'destination' WHEN access IN ('no', 'private') THEN 'no' ELSE NULL END AS access, construction,
                    CASE WHEN service IN ('parking_aisle', 'drive-through', 'driveway') THEN 'INT-minor' ELSE 'INT-normal' END AS service,
                    CASE WHEN oneway IN ('yes', '-1') THEN oneway ELSE NULL END AS oneway,
                    CASE WHEN substr(highway, length(highway)-3, 4) = 'link' THEN 'yes' ELSE 'no' END AS link,
                    makeinteger(layer) AS layernotnull
                  FROM planet_osm_line
                    WHERE (tunnel IS NULL OR NOT tunnel IN ('yes', 'building_passage'))
                      AND (covered IS NULL OR NOT covered = 'yes')
                      AND (bridge IS NULL OR NOT bridge IN ('yes', 'boardwalk', 'cantilever', 'covered', 'low_water_crossing', 'movable', 'trestle', 'viaduct'))
                ) as a
                JOIN (VALUES
                  ('highway_motorway','no',380),
                  ('highway_trunk','no',370),
                  ('highway_primary','no',360),
                  ('highway_secondary','no',350),
                  ('highway_tertiary','no',340),
                  ('highway_residential','no',330),
                  ('highway_unclassified','no',330),
                  ('highway_road','no',330),
                  ('highway_living_street','no',320),
                  ('highway_pedestrian','no',310),
                  ('highway_raceway','no',300),
                  ('highway_motorway','yes',240),
                  ('highway_trunk','yes',230),
                  ('highway_primary','yes',220),
                  ('highway_secondary','yes',210),
                  ('highway_tertiary','yes',200),
                  ('highway_service','no',150),
                  ('highway_track','no',110),
                  ('highway_path','no',100),
                  ('highway_footway','no',100),
                  ('highway_bridleway','no',100),
                  ('highway_cycleway','no',100),
                  ('highway_steps','no',100),
                  ('highway_platform','no',90),
                  ('highway_proposed','no',20),
                  ('highway_construction','no',10)
                ) AS ordertable (feature, link, prio)
                  USING (feature,link)
            )
            UNION ALL
            (SELECT way,feature,horse,foot,bicycle,tracktype,access,construction,service,oneway,link,layernotnull,prio FROM
                    (SELECT way, 
                        COALESCE(('railway_' ||(CASE WHEN railway = 'preserved' AND service IN ('spur', 'siding', 'yard') THEN 'INT-preserved-ssy' WHEN (railway = 'rail' AND service IN ('spur', 'siding', 'yard')) THEN 'INT-spur-siding-yard' ELSE railway end)), ('aeroway_' || aeroway)) AS feature,
                        horse, foot, bicycle, tracktype,
                        CASE WHEN access IN ('destination') THEN 'destination' WHEN access IN ('no', 'private') THEN 'no' ELSE NULL END AS access,
                        construction, CASE WHEN service IN ('parking_aisle', 'drive-through', 'driveway') THEN 'INT-minor' ELSE 'INT-normal' END AS service,
                        NULL AS oneway, 'no' AS link,
                        makeinteger(layer) AS layernotnull
                
                  FROM planet_osm_line
                    WHERE (tunnel IS NULL OR NOT tunnel IN ('yes', 'building_passage'))
                    AND (covered IS NULL OR NOT covered = 'yes')
                    AND (bridge IS NULL OR NOT bridge IN ('yes', 'boardwalk', 'cantilever', 'covered', 'low_water_crossing', 'movable', 'trestle', 'viaduct'))
                ) as c
                JOIN (VALUES
                  ('railway_rail', 430),
                  ('railway_spur', 430),
                  ('railway_siding', 430),('railway_INT-spur-siding-yard',430),
                  ('railway_subway', 420),
                  ('railway_narrow_gauge', 420),
                  ('railway_light_rail', 420),
                  ('railway_preserved', 420),
                  ('railway_funicular', 420),
                  ('railway_monorail', 420),
                  ('railway_miniature', 420),
                  ('railway_turntable', 420),
                  ('railway_tram', 410),
                  ('railway_disused', 400),
                  ('railway_construction', 400),
                  ('aeroway_runway', 60),
                  ('aeroway_taxiway', 50),
                  ('railway_platform', 90)
                ) AS ordertable (feature, prio)
                  USING (feature)
            )
             
          
          ) as features ORDER BY prio
        ) AS roads_casing
    properties:
      minzoom: 10
    advanced: {}
  - id: "highway-area-fill"
    name: "highway-area-fill"
    class: ""
    # FIXME: No geometry?
    <<: *extents
    Datasource:
      <<: *postds
      idx: 31
      table: |-
        (SELECT
            way,
            COALESCE(
              ('highway_' || (CASE WHEN highway IN ('residential', 'unclassified', 'pedestrian', 'service', 'footway', 'cycleway', 'living_street', 'track', 'path', 'platform', 'services') THEN highway ELSE NULL END)),
              ('railway_' || (CASE WHEN railway IN ('platform') THEN railway ELSE NULL END)),
              (('aeroway_' || CASE WHEN aeroway IN ('runway', 'taxiway', 'helipad') THEN aeroway ELSE NULL END))
            ) AS feature
          FROM planet_osm_polygon
          WHERE highway IN ('residential', 'unclassified', 'pedestrian', 'service', 'footway', 'living_street', 'track', 'path', 'platform', 'services')
            OR railway IN ('platform')
            OR aeroway IN ('runway', 'taxiway', 'helipad')
          ORDER BY z_order, way_area desc
        ) AS highway_area_fill
    properties:
      minzoom: 14
    advanced: {}
  - id: "roads-fill"
    name: "roads-fill"
    class: "roads-fill access directions"
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 32
      table: |-
        (SELECT * FROM
          (
            (SELECT way,feature,horse,foot,bicycle,tracktype,access,construction,service,oneway,link,layernotnull,prio FROM
                (SELECT way, 
                    ('highway_' || (CASE WHEN substr(highway, length(highway)-3, 4) = 'link' THEN substr(highway, 0, length(highway)-4) ELSE highway END)) AS feature,
                    horse, foot, bicycle, tracktype,
                    CASE WHEN access IN ('destination') THEN 'destination' WHEN access IN ('no', 'private') THEN 'no' ELSE NULL END AS access, construction,
                    CASE WHEN service IN ('parking_aisle', 'drive-through', 'driveway') THEN 'INT-minor' ELSE 'INT-normal' END AS service,
                    CASE WHEN oneway IN ('yes', '-1') THEN oneway ELSE NULL END AS oneway,
                    CASE WHEN substr(highway, length(highway)-3, 4) = 'link' THEN 'yes' ELSE 'no' END AS link,
                    makeinteger(layer) AS layernotnull
                  FROM planet_osm_line
                    WHERE (tunnel IS NULL OR NOT tunnel IN ('yes', 'building_passage'))
                      AND (covered IS NULL OR NOT covered = 'yes')
                      AND (bridge IS NULL OR NOT bridge IN ('yes', 'boardwalk', 'cantilever', 'covered', 'low_water_crossing', 'movable', 'trestle', 'viaduct'))
                ) as a
                JOIN (VALUES
                  ('highway_motorway','no',380),
                  ('highway_trunk','no',370),
                  ('highway_primary','no',360),
                  ('highway_secondary','no',350),
                  ('highway_tertiary','no',340),
                  ('highway_residential','no',330),
                  ('highway_unclassified','no',330),
                  ('highway_road','no',330),
                  ('highway_living_street','no',320),
                  ('highway_pedestrian','no',310),
                  ('highway_raceway','no',300),
                  ('highway_motorway','yes',240),
                  ('highway_trunk','yes',230),
                  ('highway_primary','yes',220),
                  ('highway_secondary','yes',210),
                  ('highway_tertiary','yes',200),
                  ('highway_service','no',150),
                  ('highway_track','no',110),
                  ('highway_path','no',100),
                  ('highway_footway','no',100),
                  ('highway_bridleway','no',100),
                  ('highway_cycleway','no',100),
                  ('highway_steps','no',100),
                  ('highway_platform','no',90),
                  ('highway_proposed','no',20),
                  ('highway_construction','no',10)
                ) AS ordertable (feature, link, prio)
                  USING (feature,link)
            )
            UNION ALL
            (SELECT way,feature,horse,foot,bicycle,tracktype,access,construction,service,oneway,link,layernotnull,prio FROM
                    (SELECT way, 
                        COALESCE(('railway_' ||(CASE WHEN railway = 'preserved' AND service IN ('spur', 'siding', 'yard') THEN 'INT-preserved-ssy' WHEN (railway = 'rail' AND service IN ('spur', 'siding', 'yard')) THEN 'INT-spur-siding-yard' ELSE railway end)), ('aeroway_' || aeroway)) AS feature,
                        horse, foot, bicycle, tracktype,
                        CASE WHEN access IN ('destination') THEN 'destination' WHEN access IN ('no', 'private') THEN 'no' ELSE NULL END AS access,
                        construction, CASE WHEN service IN ('parking_aisle', 'drive-through', 'driveway') THEN 'INT-minor' ELSE 'INT-normal' END AS service,
                        NULL AS oneway, 'no' AS link,
                        makeinteger(layer) AS layernotnull
                
                  FROM planet_osm_line
                    WHERE (tunnel IS NULL OR NOT tunnel IN ('yes', 'building_passage'))
                    AND (covered IS NULL OR NOT covered = 'yes')
                    AND (bridge IS NULL OR NOT bridge IN ('yes', 'boardwalk', 'cantilever', 'covered', 'low_water_crossing', 'movable', 'trestle', 'viaduct'))
                ) as c
                JOIN (VALUES
                  ('railway_rail', 430),
                  ('railway_spur', 430),
                  ('railway_siding', 430),('railway_INT-spur-siding-yard',430),
                  ('railway_subway', 420),
                  ('railway_narrow_gauge', 420),
                  ('railway_light_rail', 420),
                  ('railway_preserved', 420),
                  ('railway_funicular', 420),
                  ('railway_monorail', 420),
                  ('railway_miniature', 420),
                  ('railway_turntable', 420),
                  ('railway_tram', 410),
                  ('railway_disused', 400),
                  ('railway_construction', 400),
                  ('aeroway_runway', 60),
                  ('aeroway_taxiway', 50),
                  ('railway_platform', 90)
                ) AS ordertable (feature, prio)
                  USING (feature)
            )
             
          
          ) as features ORDER BY prio
        ) AS roads_fill
    properties:
      minzoom: 10
    advanced: {}
  - id: "turning-circle-fill"
    name: "turning-circle-fill"
    class: ""
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 33
      table: |-
        ( SELECT way,    parent_highway AS int_tc_type,
            CASE WHEN service IN ('parking_aisle', 'drive-through', 'driveway') THEN 'INT-minor' ELSE 'INT-normal' END AS int_tc_service
          FROM planet_osm_point 
          WHERE highway = 'turning_circle' OR highway = 'turning_loop')
        AS turning_circle_casing
    properties:
      minzoom: 15
    advanced: {}
  - id: "aerialways"
    name: "aerialways"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 34
      table: |-
        (SELECT way, aerialway FROM planet_osm_line WHERE aerialway IS NOT NULL) AS aerialways
    properties:
      minzoom: 12
    advanced: {}
  - id: "roads-low-zoom"
    name: "roads-low-zoom"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 35
      table: |-
              (SELECT way, COALESCE(('highway_' || (CASE WHEN substr(highway, length(highway)-3, 4) = 'link' THEN substr(highway, 0, length(highway)-4) ELSE highway end)), ('railway_' || (CASE WHEN (railway = 'rail' AND service IN ('spur', 'siding', 'yard')) THEN 'INT-spur-siding-yard' WHEN railway IN ('rail', 'tram', 'light_rail', 'funicular', 'narrow_gauge') THEN railway ELSE NULL END))) AS feature,
                    CASE WHEN tunnel = 'yes' OR tunnel = 'building_passage' OR covered = 'yes' THEN 'yes' ELSE 'no' END AS int_tunnel,
                    CASE WHEN substr(highway, length(highway)-3, 4) = 'link' THEN 'yes' ELSE 'no' END AS link
               FROM planet_osm_roads
               WHERE highway IS NOT NULL
                  OR (railway IS NOT NULL AND railway != 'preserved' AND (service IS NULL OR service NOT IN ('spur', 'siding', 'yard')))
               ORDER BY z_order
              ) AS roads_low_zoom
    properties:
      minzoom: 5
      maxzoom: 12
    advanced: {}
  - id: "waterway-bridges"
    name: "waterway-bridges"
    class: "water-lines"
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 36
      table: |-
        (SELECT way, waterway, name, intermittent, CASE WHEN tunnel IN ('yes', 'culvert') THEN 'yes' ELSE 'no' END AS int_tunnel, 'yes' AS bridge FROM planet_osm_line WHERE waterway IN ('river', 'canal', 'derelict_canal', 'stream', 'drain', 'ditch', 'wadi') AND bridge IN ('yes', 'aqueduct') ORDER BY z_order) AS waterway_bridges
    properties:
      minzoom: 15
    advanced: {}
  - id: "bridges"
    name: "bridges"
    class: "bridges-fill bridges-casing access directions"
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 37
      table: |-
        (SELECT * FROM
          (
            (SELECT way,feature,horse,foot,bicycle,tracktype,access,construction,service,oneway,link,layernotnull,prio FROM
                (SELECT way, 
                    ('highway_' || (CASE WHEN substr(highway, length(highway)-3, 4) = 'link' THEN substr(highway, 0, length(highway)-4) ELSE highway END)) AS feature,
                    horse, foot, bicycle, tracktype,
                    CASE WHEN access IN ('destination') THEN 'destination' WHEN access IN ('no', 'private') THEN 'no' ELSE NULL END AS access, construction,
                    CASE WHEN service IN ('parking_aisle', 'drive-through', 'driveway') THEN 'INT-minor' ELSE 'INT-normal' END AS service,
                    CASE WHEN oneway IN ('yes', '-1') THEN oneway ELSE NULL END AS oneway,
                    CASE WHEN substr(highway, length(highway)-3, 4) = 'link' THEN 'yes' ELSE 'no' END AS link,
                    makeinteger(layer) AS layernotnull
                  FROM planet_osm_line
                    WHERE bridge IN ('yes', 'boardwalk', 'cantilever', 'covered', 'low_water_crossing', 'movable', 'trestle', 'viaduct')
                ) as a
                JOIN (VALUES
                  ('highway_motorway','no',380),
                  ('highway_trunk','no',370),
                  ('highway_primary','no',360),
                  ('highway_secondary','no',350),
                  ('highway_tertiary','no',340),
                  ('highway_residential','no',330),
                  ('highway_unclassified','no',330),
                  ('highway_road','no',330),
                  ('highway_living_street','no',320),
                  ('highway_pedestrian','no',310),
                  ('highway_raceway','no',300),
                  ('highway_motorway','yes',240),
                  ('highway_trunk','yes',230),
                  ('highway_primary','yes',220),
                  ('highway_secondary','yes',210),
                  ('highway_tertiary','yes',200),
                  ('highway_service','no',150),
                  ('highway_track','no',110),
                  ('highway_path','no',100),
                  ('highway_footway','no',100),
                  ('highway_bridleway','no',100),
                  ('highway_cycleway','no',100),
                  ('highway_steps','no',100),
                  ('highway_platform','no',90),
                  ('highway_proposed','no',20),
                  ('highway_construction','no',10)
                ) AS ordertable (feature, link, prio)
                  USING (feature,link)
            )
            UNION ALL
            (SELECT way,feature,horse,foot,bicycle,tracktype,access,construction,service,oneway,link,layernotnull,prio FROM
                    (SELECT way, 
                        COALESCE(('railway_' ||(CASE WHEN railway = 'preserved' AND service IN ('spur', 'siding', 'yard') THEN 'INT-preserved-ssy' WHEN (railway = 'rail' AND service IN ('spur', 'siding', 'yard')) THEN 'INT-spur-siding-yard' ELSE railway end)), ('aeroway_' || aeroway)) AS feature,
                        horse, foot, bicycle, tracktype,
                        CASE WHEN access IN ('destination') THEN 'destination' WHEN access IN ('no', 'private') THEN 'no' ELSE NULL END AS access,
                        construction, CASE WHEN service IN ('parking_aisle', 'drive-through', 'driveway') THEN 'INT-minor' ELSE 'INT-normal' END AS service,
                        NULL AS oneway, 'no' AS link,
                        makeinteger(layer) AS layernotnull
                
                  FROM planet_osm_line
                    WHERE bridge IN ('yes', 'boardwalk', 'cantilever', 'covered', 'low_water_crossing', 'movable', 'trestle', 'viaduct')
                ) as c
                JOIN (VALUES
                  ('railway_rail', 430),
                  ('railway_spur', 430),
                  ('railway_siding', 430),('railway_INT-spur-siding-yard',430),
                  ('railway_subway', 420),
                  ('railway_narrow_gauge', 420),
                  ('railway_light_rail', 420),
                  ('railway_preserved', 420),
                  ('railway_funicular', 420),
                  ('railway_monorail', 420),
                  ('railway_miniature', 420),
                  ('railway_turntable', 420),
                  ('railway_tram', 410),
                  ('railway_disused', 400),
                  ('railway_construction', 400),
                  ('aeroway_runway', 60),
                  ('aeroway_taxiway', 50),
                  ('railway_platform', 90)
                ) AS ordertable (feature, prio)
                  USING (feature)
            )
             
          
          ) as features ORDER BY layernotnull,prio,case when access in ('no', 'private') then 0 when access in ('destination') then 1 else 2 end
        ) AS bridges
    properties:
      group-by: "layernotnull"
      minzoom: 10
    advanced: {}
  - id: "guideways"
    name: "guideways"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 38
      table: |-
        (SELECT way FROM planet_osm_line WHERE highway = 'bus_guideway' AND (tunnel IS NULL OR tunnel != 'yes')) AS guideways
    properties:
      minzoom: 13
    advanced: {}
  - name: "admin-low-zoom"
    id: "admin-low-zoom"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 39
      table: |-
        (SELECT way, admin_level
               FROM planet_osm_roads
               WHERE "boundary" = 'administrative'
                 AND admin_level IN ('0', '1', '2', '3', '4')
               ORDER BY admin_level DESC
               ) AS admin_low_zoom
    properties:
      maxzoom: 10
    advanced: {}
  - id: "admin-mid-zoom"
    name: "admin-mid-zoom"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 40
      table: |-
        (SELECT way, admin_level
               FROM planet_osm_roads
               WHERE "boundary" = 'administrative'
                 AND admin_level IN ('0', '1', '2', '3', '4', '5', '6', '7', '8')
               ORDER BY admin_level DESC
               ) AS admin_mid_zoom
    properties:
      minzoom: 11
      maxzoom: 12
    advanced: {}
  - id: "admin-high-zoom"
    name: "admin-high-zoom"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 41
      table: |-
        (SELECT way, admin_level
               FROM planet_osm_roads
               WHERE "boundary" = 'administrative'
                 AND admin_level IN ('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10')
               ORDER BY admin_level DESC
               ) AS admin_high_zoom
    properties:
      minzoom: 13
    advanced: {}
  - id: "power-minorline"
    name: "power-minorline"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 42
      table: |-
        (SELECT way FROM planet_osm_line WHERE "power" = 'minor_line') AS power_minorline
    properties:
      minzoom: 16
    advanced: {}
  - id: "power-line"
    name: "power-line"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 43
      table: |-
        (SELECT way FROM planet_osm_line WHERE "power" = 'line') AS power_line
    properties:
      minzoom: 14
    advanced: {}
  - id: "nature-reserve-boundaries"
    name: "nature-reserve-boundaries"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 44
      table: |-
        (SELECT way, way_area, name, boundary, way_area/(!pixel_width!*!pixel_height!) AS way_pixels FROM planet_osm_polygon WHERE (boundary = 'national_park' OR leisure = 'nature_reserve') AND building IS NULL) AS national_park_boundaries
    properties:
      minzoom: 7
    advanced: {}
  - id: "theme-park"
    name: "theme-park"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 45
      table: |-
        (SELECT way, name, tourism FROM planet_osm_polygon WHERE tourism = 'theme_park') AS theme_park
    properties:
      minzoom: 13
    advanced: {}
  - id: "placenames-large"
    name: "placenames-large"
    class: "country state"
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 46
      table: |-
        (SELECT way, way_area/(!pixel_width!*!pixel_height!) AS way_pixels, name, ref, admin_level
               FROM planet_osm_polygon
               WHERE boundary = 'administrative' AND admin_level IN ('2', '4')
              ) AS placenames_large
    properties:
      minzoom: 2
    advanced: {}
  - id: "nepopulated"
    name: "nepopulated"
    class: ""
    geometry: "point"
    <<: *extents84
    Datasource:
      file: "data/ne_10m_populated_places/ne_10m_populated_places_fixed.shp"
      type: "shape"
      encoding: "windows-1252"
    properties:
      minzoom: 3
      maxzoom: 4
    advanced:
      encoding: "windows-1252"
  - id: "placenames-capital"
    name: "placenames-capital"
    class: ""
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 48
      table: |-
        (SELECT way, place, name, ref
               FROM planet_osm_point
               WHERE place IN ('city', 'town') AND  (capital = 'yes' OR capital = '4')
              ) AS placenames_capital
    properties:
      minzoom: 5
      maxzoom: 14
    advanced: {}
  - id: "placenames-medium"
    name: "placenames-medium"
    class: ""
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 49
      table: |-
        (SELECT way, place, name
              FROM planet_osm_point
              WHERE place IN ('city', 'town')
                AND (capital IS NULL OR (capital != 'yes' AND capital != '4') )
              ) AS placenames_medium
    properties:
      minzoom: 6
    advanced: {}
  - id: "placenames-small"
    name: "placenames-small"
    class: ""
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 50
      table: |-
        (SELECT way, place, name
              FROM planet_osm_point
              WHERE place IN ('suburb', 'village', 'hamlet', 'neighbourhood', 'locality', 'isolated_dwelling', 'farm')
              ) AS placenames_small
    properties:
      minzoom: 12
    advanced: {}
  - id: "stations"
    class: "stations"
    name: "stations"
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 51
      table: |-
              (SELECT way, name, railway, aerialway, disused
              FROM planet_osm_point
              WHERE railway IN ('station', 'halt', 'tram_stop', 'subway_entrance')
                 OR aerialway = 'station'
              ) AS stations
    properties:
      minzoom: 12
    advanced: {}
  - id: "stations-poly"
    name: "stations-poly"
    class: "stations"
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 52
      table: |-
              (SELECT way, name, railway, aerialway, disused
              FROM planet_osm_polygon
              WHERE railway IN ('station', 'halt', 'tram_stop')
                 OR aerialway = 'station'
              ) AS stations_poly
    properties:
      minzoom: 12
    advanced: {}
  - id: "trees"
    name: "trees"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 53
      table: |-
              (SELECT way, natural FROM planet_osm_point WHERE natural = 'tree'
                    UNION ALL
               SELECT way, natural FROM planet_osm_line WHERE natural = 'tree_row'
               ) AS trees
    properties:
      minzoom: 16
    advanced: {}
  - id: "amenity-points-poly"
    name: "amenity-points-poly"
    class: "points"
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 54
      table: |-
        (SELECT
            way,
            COALESCE(
              'aeroway_' || CASE WHEN aeroway IN ('helipad', 'aerodrome') THEN aeroway ELSE NULL END,
              'tourism_' || CASE WHEN tourism IN ('alpine_hut', 'camp_site', 'caravan_site', 'chalet', 'guest_house', 'hostel', 'hotel', 'motel', 'information', 'museum', 'viewpoint', 'picnic_site') THEN tourism ELSE NULL END,
              'amenity_' || CASE WHEN amenity IN ('shelter', 'atm', 'bank', 'bar', 'bicycle_rental', 'bus_station', 'cafe', 'car_sharing', 'cinema', 'fire_station', 'fuel', 'hospital', 'embassy', 'library', 'courthouse', 'townhall', 'parking', 'pharmacy', 'doctors', 'dentist', 'place_of_worship', 'police', 'post_box', 'post_office', 'pub', 'biergarten', 'recycling', 'restaurant', 'food_court', 'fast_food', 'telephone', 'emergency_phone', 'theatre', 'toilets', 'drinking_water', 'prison') THEN amenity ELSE NULL END,
              'shop_' || CASE WHEN shop IN ('supermarket', 'bakery', 'butcher', 'clothes', 'fashion', 'convenience', 'department_store', 'doityourself', 'florist', 'hairdresser', 'car', 'car_repair', 'bicycle', 'mall') THEN shop WHEN shop IN ('accessories', 'alcohol', 'antique', 'antiques', 'appliance', 'art', 'baby_goods', 'bag', 'bags', 'bakery', 'bathroom_furnishing', 'beauty', 'bed', 'betting', 'beverages', 'bicycle', 'boat', 'bookmaker', 'books', 'boutique', 'builder', 'building_materials', 'butcher', 'camera', 'car', 'car_parts', 'car_repair', 'car_service', 'carpet', 'charity', 'cheese', 'chemist', 'chocolate', 'clothes', 'coffee', 'communication', 'computer', 'confectionery', 'convenience', 'copyshop', 'cosmetics', 'craft', 'curtain', 'dairy', 'deli', 'delicatessen', 'department_store', 'discount', 'dive', 'doityourself', 'dry_cleaning', 'e-cigarette', 'electrical', 'electronics', 'energy', 'erotic', 'estate_agent', 'fabric', 'farm', 'fashion', 'fish', 'fishing', 'fishmonger', 'flooring', 'florist', 'food', 'frame', 'frozen_food', 'funeral_directors', 'furnace', 'furniture', 'gallery', 'gambling', 'games', 'garden_centre', 'gas', 'general', 'gift', 'glaziery', 'greengrocer', 'grocery', 'hairdresser', 'hardware', 'health', 'health_food', 'hearing_aids', 'herbalist', 'hifi', 'hobby', 'household', 'houseware', 'hunting', 'ice_cream', 'insurance', 'interior_decoration', 'jewellery', 'jewelry', 'kiosk', 'kitchen', 'laundry', 'leather', 'lighting', 'locksmith', 'lottery', 'mall', 'market', 'massage', 'medical', 'medical_supply', 'mobile_phone', 'money_lender', 'motorcycle', 'motorcycle_repair', 'music', 'musical_instrument', 'newsagent', 'office_supplies', 'optician', 'organic', 'outdoor', 'paint', 'pastry', 'pawnbroker', 'perfumery', 'pet', 'pets', 'pharmacy', 'phone', 'photo', 'photo_studio', 'photography', 'pottery', 'printing', 'radiotechnics', 'real_estate', 'religion', 'rental', 'salon', 'scuba_diving', 'seafood', 'second_hand', 'sewing', 'shoe_repair', 'shoes', 'shopping_centre', 'solarium', 'souvenir', 'sports', 'stationery', 'supermarket', 'tailor', 'tanning', 'tattoo', 'tea', 'ticket', 'tiles', 'tobacco', 'toys', 'trade', 'travel_agency', 'tyres', 'vacuum_cleaner', 'variety_store', 'video', 'video_games', 'watches', 'wholesale', 'wine', 'winery', 'yes') THEN 'other' ELSE NULL END,
              'leisure_' || CASE WHEN leisure IN ('water_park', 'playground', 'miniature_golf', 'golf_course', 'picnic_table') THEN leisure ELSE NULL END,
              'man_made_' || CASE WHEN man_made IN ('mast', 'water_tower', 'lighthouse', 'windmill') THEN man_made ELSE NULL END,
              'natural_' || CASE WHEN "natural" IN ('peak', 'volcano', 'saddle', 'spring') THEN "natural" ELSE NULL END,
              'historic_' || CASE WHEN historic IN ('memorial', 'archaeological_site') THEN historic ELSE NULL END,
              'highway_'|| CASE WHEN highway IN ('bus_stop', 'traffic_signals') THEN highway ELSE NULL END,
              'power_' || CASE WHEN power IN ('generator') THEN power ELSE NULL END
            ) AS feature,
            access,
            religion,
            denomination,
            "generator:source",
            power_source
          FROM planet_osm_polygon
          WHERE aeroway IN ('helipad', 'aerodrome')
            OR tourism IN ('alpine_hut', 'camp_site', 'caravan_site', 'chalet', 'guest_house', 'hostel', 'hotel', 'motel', 'information', 'museum', 'viewpoint', 'picnic_site')
            OR amenity IN ('shelter', 'atm', 'bank', 'bar', 'bicycle_rental', 'bus_station', 'cafe', 'car_sharing', 'cinema', 'fire_station', 'fuel', 'hospital', 'embassy', 'library', 'courthouse', 'townhall', 'parking', 'pharmacy', 'doctors', 'dentist', 'place_of_worship', 'police', 'post_box', 'post_office', 'pub', 'biergarten', 'recycling', 'restaurant', 'food_court', 'fast_food', 'telephone', 'emergency_phone', 'theatre', 'toilets', 'drinking_water', 'prison')
            OR shop IS NOT NULL 
            OR leisure IN ('water_park', 'playground', 'miniature_golf', 'golf_course', 'picnic_table')
            OR man_made IN ('mast', 'water_tower', 'lighthouse', 'windmill')
            OR "natural" IN ('peak', 'volcano', 'saddle', 'spring')
            OR historic IN ('memorial', 'archaeological_site')
            OR highway IN ('bus_stop', 'traffic_signals')
            OR (power = 'generator' AND ("generator:source" = 'wind' OR power_source = 'wind'))
          ORDER BY way_area desc
        ) AS amenity_points_poly
    properties:
      minzoom: 13
    advanced: {}
  - id: "amenity-points"
    name: "amenity-points"
    class: "points"
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 55
      table: |-
        (SELECT
            way,
            COALESCE(
              'aeroway_' || CASE WHEN aeroway IN ('helipad', 'aerodrome') THEN aeroway ELSE NULL END,
              'tourism_' || CASE WHEN tourism IN ('alpine_hut', 'camp_site', 'caravan_site', 'chalet', 'guest_house', 'hostel', 'hotel', 'motel', 'information', 'museum', 'viewpoint', 'picnic_site') THEN tourism ELSE NULL END,
              'amenity_' || CASE WHEN amenity IN ('shelter', 'atm', 'bank', 'bar', 'bicycle_rental', 'bus_station', 'cafe', 'car_sharing', 'cinema', 'fire_station', 'fuel', 'hospital', 'embassy', 'library', 'courthouse', 'townhall', 'parking', 'pharmacy', 'doctors', 'dentist', 'place_of_worship', 'police', 'post_box', 'post_office', 'pub', 'biergarten', 'recycling', 'restaurant', 'food_court', 'fast_food', 'telephone', 'emergency_phone', 'theatre', 'toilets', 'drinking_water', 'prison') THEN amenity ELSE NULL END,
              'shop_' || CASE WHEN shop IN ('supermarket', 'bakery', 'butcher', 'clothes', 'fashion', 'convenience', 'department_store', 'doityourself', 'florist', 'hairdresser', 'car', 'car_repair', 'bicycle', 'mall') THEN shop WHEN shop IN ('accessories', 'alcohol', 'antique', 'antiques', 'appliance', 'art', 'baby_goods', 'bag', 'bags', 'bakery', 'bathroom_furnishing', 'beauty', 'bed', 'betting', 'beverages', 'bicycle', 'boat', 'bookmaker', 'books', 'boutique', 'builder', 'building_materials', 'butcher', 'camera', 'car', 'car_parts', 'car_repair', 'car_service', 'carpet', 'charity', 'cheese', 'chemist', 'chocolate', 'clothes', 'coffee', 'communication', 'computer', 'confectionery', 'convenience', 'copyshop', 'cosmetics', 'craft', 'curtain', 'dairy', 'deli', 'delicatessen', 'department_store', 'discount', 'dive', 'doityourself', 'dry_cleaning', 'e-cigarette', 'electrical', 'electronics', 'energy', 'erotic', 'estate_agent', 'fabric', 'farm', 'fashion', 'fish', 'fishing', 'fishmonger', 'flooring', 'florist', 'food', 'frame', 'frozen_food', 'funeral_directors', 'furnace', 'furniture', 'gallery', 'gambling', 'games', 'garden_centre', 'gas', 'general', 'gift', 'glaziery', 'greengrocer', 'grocery', 'hairdresser', 'hardware', 'health', 'health_food', 'hearing_aids', 'herbalist', 'hifi', 'hobby', 'household', 'houseware', 'hunting', 'ice_cream', 'insurance', 'interior_decoration', 'jewellery', 'jewelry', 'kiosk', 'kitchen', 'laundry', 'leather', 'lighting', 'locksmith', 'lottery', 'mall', 'market', 'massage', 'medical', 'medical_supply', 'mobile_phone', 'money_lender', 'motorcycle', 'motorcycle_repair', 'music', 'musical_instrument', 'newsagent', 'office_supplies', 'optician', 'organic', 'outdoor', 'paint', 'pastry', 'pawnbroker', 'perfumery', 'pet', 'pets', 'pharmacy', 'phone', 'photo', 'photo_studio', 'photography', 'pottery', 'printing', 'radiotechnics', 'real_estate', 'religion', 'rental', 'salon', 'scuba_diving', 'seafood', 'second_hand', 'sewing', 'shoe_repair', 'shoes', 'shopping_centre', 'solarium', 'souvenir', 'sports', 'stationery', 'supermarket', 'tailor', 'tanning', 'tattoo', 'tea', 'ticket', 'tiles', 'tobacco', 'toys', 'trade', 'travel_agency', 'tyres', 'vacuum_cleaner', 'variety_store', 'video', 'video_games', 'watches', 'wholesale', 'wine', 'winery', 'yes') THEN 'other' ELSE NULL END,
              'leisure_' || CASE WHEN leisure IN ('water_park', 'playground', 'miniature_golf', 'golf_course', 'picnic_table', 'slipway') THEN leisure ELSE NULL END,
              'man_made_' || CASE WHEN man_made IN ('mast', 'water_tower', 'lighthouse', 'windmill') THEN man_made ELSE NULL END,
              'natural_' || CASE WHEN "natural" IN ('peak', 'volcano', 'saddle', 'spring') THEN "natural" ELSE NULL END,
              'waterway_' || CASE WHEN waterway IN ('lock') THEN waterway ELSE NULL END,
              'historic_' || CASE WHEN historic IN ('memorial', 'archaeological_site') THEN historic ELSE NULL END,
              'lock_' || CASE WHEN lock IN ('yes') THEN lock ELSE NULL END,
              'highway_'|| CASE WHEN highway IN ('bus_stop', 'traffic_signals', 'ford') THEN highway ELSE NULL END,
              'power_' || CASE WHEN power IN ('generator') THEN power ELSE NULL END
            ) AS feature,
            access,
            religion,
            denomination,
            "generator:source",
            power_source
          FROM planet_osm_point
          WHERE aeroway IN ('helipad', 'aerodrome')
            OR tourism IN ('alpine_hut', 'camp_site', 'caravan_site', 'chalet', 'guest_house', 'hostel', 'hotel', 'motel', 'information', 'museum', 'viewpoint', 'picnic_site')
            OR amenity IN ('shelter', 'atm', 'bank', 'bar', 'bicycle_rental', 'bus_station', 'cafe', 'car_sharing', 'cinema', 'fire_station', 'fuel', 'hospital', 'embassy', 'library', 'courthouse', 'townhall', 'parking', 'pharmacy', 'doctors', 'dentist', 'place_of_worship', 'police', 'post_box', 'post_office', 'pub', 'biergarten', 'recycling', 'restaurant', 'food_court', 'fast_food', 'telephone', 'emergency_phone', 'theatre', 'toilets', 'drinking_water', 'prison')
            OR shop IS NOT NULL 
            OR leisure IN ('water_park', 'playground', 'miniature_golf', 'golf_course', 'picnic_table', 'slipway')
            OR man_made IN ('mast', 'water_tower', 'lighthouse', 'windmill')
            OR "natural" IN ('peak', 'volcano', 'saddle', 'spring', 'cave_entrance')
            OR waterway = 'lock'
            OR historic IN ('memorial', 'archaeological_site')
            OR lock = 'yes'
            OR highway IN ('bus_stop', 'traffic_signals', 'ford')
            OR (power = 'generator' AND ("generator:source" = 'wind' OR power_source = 'wind'))
          ) AS amenity_points
    properties:
      minzoom: 13
    advanced: {}
  - id: "power-towers"
    name: "power-towers"
    class: ""
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 56
      table: |-
        (SELECT way FROM planet_osm_point WHERE power = 'tower') AS power_towers
    properties:
      minzoom: 14
    advanced: {}
  - id: "power-poles"
    name: "power-poles"
    class: ""
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 57
      table: |-
        (SELECT way FROM planet_osm_point WHERE power = 'pole') AS power_poles
    properties:
      minzoom: 16
    advanced: {}
  - id: "roads-text-ref-low-zoom"
    name: "roads-text-ref-low-zoom"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 58
      table: |-
        (SELECT way, highway, 1 as height, char_length(ref) as width, ref as refs
            FROM planet_osm_roads 
            WHERE 
                highway IN ('motorway', 'trunk', 'primary', 'secondary')
                AND ref IS NOT NULL
        ) AS roads_text_ref_low_zoom
    properties:
      minzoom: 10
      maxzoom: 12
    advanced: {}
  - id: "junctions"
    name: "junctions"
    class: ""
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 59
      table: |-
             (SELECT way, highway, junction, ref, name
              FROM planet_osm_point
              WHERE highway = 'motorway_junction' OR highway = 'traffic_signals' OR junction = 'yes'
             ) AS junctions
    properties:
      minzoom: 11
    advanced: {}
  - id: "roads-text-ref"
    name: "roads-text-ref"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 60
      table: |-
        (SELECT way, highway, 1 as height, char_length(ref) as width, ref as refs
            FROM planet_osm_line
            WHERE (highway IN ('motorway', 'trunk', 'primary', 'secondary')
                    OR aeroway IN ('runway', 'taxiway'))
                AND ref IS NOT NULL
        ) AS roads_text_ref
    properties:
      minzoom: 13
    advanced: {}
  - id: "roads-area-text-name"
    name: "roads-area-text-name"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 61
      table: |-
              (SELECT way, way_area/(!pixel_width!*!pixel_height!) AS way_pixels, highway, name
               FROM planet_osm_polygon
               WHERE highway IN ('residential', 'unclassified', 'pedestrian', 'service', 'footway', 'cycleway', 'living_street', 'track', 'path', 'platform') OR railway IN ('platform') AND name IS NOT NULL
              ) AS roads_area_text_name
    properties:
      minzoom: 15
    advanced: {}
  - id: "roads-text-name"
    name: "roads-text-name"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 62
      table: |-
              (SELECT way,
                 CASE WHEN substr(highway, length(highway)-3, 4) = 'link' THEN substr(highway, 0, length(highway)-4) ELSE highway END as highway,
                 CASE WHEN (tunnel = 'yes' OR tunnel = 'building_passage' OR covered = 'yes') THEN 'yes' ELSE 'no' END AS tunnel,
                 CASE WHEN (construction IN ('service', 'footway', 'cycleway', 'bridleway', 'path', 'track')) THEN 'yes' ELSE 'no' END AS int_construction_minor,
                 name
               FROM planet_osm_line
               WHERE highway IN ('motorway', 'motorway_link', 'trunk', 'trunk_link', 'primary', 'primary_link', 'secondary', 'secondary_link', 'tertiary', 'tertiary_link', 'residential', 'unclassified', 'road', 'service', 'pedestrian', 'raceway', 'living_street', 'construction', 'proposed')
                 AND name IS NOT NULL
              ) AS roads_text_name
    properties:
      minzoom: 13
    advanced: {}
  - id: "paths-text-name"
    name: "paths-text-name"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 63
      table: |-
              (SELECT way, highway, name
               FROM planet_osm_line
               WHERE highway IN ('bridleway', 'footway', 'cycleway', 'path', 'track', 'steps')
                 AND name IS NOT NULL
              ) AS paths_text_name
    properties:
      minzoom: 15
    advanced: {}
  - id: "text-poly-low-zoom"
    name: "text-poly-low-zoom"
    class: "text-low-zoom"
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 64
      table: |-
          (SELECT way, way_area/(!pixel_width!*!pixel_height!) AS way_pixels,
              COALESCE('landuse_' || landuse, 'natural_' || "natural", 'boundary_' || boundary) AS feature,
              name,
              way_area,
              CASE WHEN building = 'no' OR building IS NULL THEN 'no' ELSE 'yes' END AS is_building
            FROM planet_osm_polygon
            WHERE (landuse IN ('forest')
              OR "natural" IN ('wood', 'glacier', 'sand', 'scree', 'shingle', 'bare_rock')
              OR boundary IN ('national_park'))
              AND building IS NULL
            ORDER BY way_area DESC
          ) AS text_poly_low_zoom
    properties:
      minzoom: 7
      maxzoom: 9
    advanced: {}
  - id: "text-poly"
    name: "text-poly"
    class: "text"
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 65
      table: |-
        (SELECT
            way,
            way_area/(!pixel_width!*!pixel_height!) AS way_pixels,
            COALESCE(
              'aeroway_' || CASE WHEN aeroway IN ('gate', 'apron', 'helipad', 'aerodrome') THEN aeroway ELSE NULL END,
              'tourism_' || CASE WHEN tourism IN ('alpine_hut', 'hotel', 'motel', 'hostel', 'chalet', 'guest_house', 'camp_site', 'caravan_site', 'theme_park', 'museum', 'attraction', 'zoo', 'information', 'picnic_site') THEN tourism ELSE NULL END,
              'amenity_' || CASE WHEN amenity IN ('pub', 'restaurant', 'food_court', 'cafe', 'fast_food', 'biergarten', 'bar', 'library', 'theatre', 'courthouse', 'townhall', 'cinema', 'parking', 'police', 'fire_station', 'place_of_worship', 'grave_yard', 'shelter', 'bank', 'embassy', 'fuel', 'bus_station', 'prison', 'university', 'school', 'college', 'kindergarten', 'hospital', 'pharmacy', 'doctors', 'dentist', 'atm', 'bicycle_rental', 'car_sharing', 'post_box', 'post_office', 'recycling', 'telephone', 'emergency_phone', 'toilets', 'drinking_water') THEN amenity ELSE NULL END,
              'shop_' || CASE WHEN shop IN ('supermarket', 'bakery', 'butcher', 'clothes', 'fashion', 'convenience', 'department_store', 'doityourself', 'florist', 'hairdresser', 'car', 'car_repair', 'bicycle', 'mall') THEN shop WHEN shop IN ('accessories', 'alcohol', 'antique', 'antiques', 'appliance', 'art', 'baby_goods', 'bag', 'bags', 'bakery', 'bathroom_furnishing', 'beauty', 'bed', 'betting', 'beverages', 'bicycle', 'boat', 'bookmaker', 'books', 'boutique', 'builder', 'building_materials', 'butcher', 'camera', 'car', 'car_parts', 'car_repair', 'car_service', 'carpet', 'charity', 'cheese', 'chemist', 'chocolate', 'clothes', 'coffee', 'communication', 'computer', 'confectionery', 'convenience', 'copyshop', 'cosmetics', 'craft', 'curtain', 'dairy', 'deli', 'delicatessen', 'department_store', 'discount', 'dive', 'doityourself', 'dry_cleaning', 'e-cigarette', 'electrical', 'electronics', 'energy', 'erotic', 'estate_agent', 'fabric', 'farm', 'fashion', 'fish', 'fishing', 'fishmonger', 'flooring', 'florist', 'food', 'frame', 'frozen_food', 'funeral_directors', 'furnace', 'furniture', 'gallery', 'gambling', 'games', 'garden_centre', 'gas', 'general', 'gift', 'glaziery', 'greengrocer', 'grocery', 'hairdresser', 'hardware', 'health', 'health_food', 'hearing_aids', 'herbalist', 'hifi', 'hobby', 'household', 'houseware', 'hunting', 'ice_cream', 'insurance', 'interior_decoration', 'jewellery', 'jewelry', 'kiosk', 'kitchen', 'laundry', 'leather', 'lighting', 'locksmith', 'lottery', 'mall', 'market', 'massage', 'medical', 'medical_supply', 'mobile_phone', 'money_lender', 'motorcycle', 'motorcycle_repair', 'music', 'musical_instrument', 'newsagent', 'office_supplies', 'optician', 'organic', 'outdoor', 'paint', 'pastry', 'pawnbroker', 'perfumery', 'pet', 'pets', 'pharmacy', 'phone', 'photo', 'photo_studio', 'photography', 'pottery', 'printing', 'radiotechnics', 'real_estate', 'religion', 'rental', 'salon', 'scuba_diving', 'seafood', 'second_hand', 'sewing', 'shoe_repair', 'shoes', 'shopping_centre', 'solarium', 'souvenir', 'sports', 'stationery', 'supermarket', 'tailor', 'tanning', 'tattoo', 'tea', 'ticket', 'tiles', 'tobacco', 'toys', 'trade', 'travel_agency', 'tyres', 'vacuum_cleaner', 'variety_store', 'video', 'video_games', 'watches', 'wholesale', 'wine', 'winery', 'yes') THEN 'other' ELSE NULL END,
              'leisure_' || CASE WHEN leisure IN ('swimming_pool', 'water_park', 'miniature_golf', 'golf_course', 'sports_centre', 'stadium', 'track', 'pitch', 'playground', 'park', 'recreation_ground', 'common', 'garden', 'nature_reserve', 'marina', 'slipway') THEN leisure ELSE NULL END,
              'landuse_' || CASE WHEN landuse IN ('reservoir', 'basin', 'recreation_ground', 'conservation', 'village_green', 'quarry', 'vineyard', 'orchard', 'cemetery', 'residential', 'garages', 'meadow', 'grass', 'allotments', 'forest', 'farmyard', 'farm', 'farmland', 'retail', 'industrial', 'railway', 'commercial', 'brownfield', 'landfill', 'construction', 'military') THEN landuse ELSE NULL END,
              'man_made_' || CASE WHEN man_made IN ('lighthouse', 'windmill', 'mast', 'water_tower') THEN man_made ELSE NULL END,
              'natural_' || CASE WHEN "natural" IN ('wood', 'peak', 'volcano', 'saddle', 'cave_entrance', 'water', 'lake', 'mud', 'wetland', 'marsh', 'bay', 'spring', 'scree', 'shingle', 'bare_rock', 'sand', 'heath', 'grassland', 'scrub', 'beach', 'glacier') THEN "natural" ELSE NULL END,
              'place_' || CASE WHEN place IN ('island', 'islet') THEN place ELSE NULL END,
              'military_' || CASE WHEN military IN ('danger_area') THEN military ELSE NULL END,
              'historic_' || CASE WHEN historic IN ('memorial', 'archaeological_site') THEN historic ELSE NULL END,
              'highway_' || CASE WHEN highway IN ('services', 'rest_area', 'bus_stop', 'ford') THEN highway ELSE NULL END,
              'power_' || CASE WHEN power IN ('station', 'generator', 'sub_station', 'substation') THEN power ELSE NULL END,
              'boundary_' || CASE WHEN boundary IN ('national_park') THEN boundary ELSE NULL END
            ) AS feature,
            access,
            name,
            ref,
            way_area,
            CASE WHEN building = 'no' OR building IS NULL THEN 'no' ELSE 'yes' END AS is_building
          FROM planet_osm_polygon
          WHERE aeroway IN ('gate', 'apron', 'helipad', 'aerodrome')
            OR tourism IN ('alpine_hut', 'hotel', 'motel', 'hostel', 'chalet', 'guest_house', 'camp_site', 'caravan_site', 'theme_park', 'museum', 'attraction', 'zoo', 'information', 'picnic_site')
            OR amenity IN ('pub', 'restaurant', 'food_court', 'cafe', 'fast_food', 'biergarten', 'bar', 'library', 'theatre', 'courthouse', 'townhall', 'cinema', 'parking', 'police', 'fire_station', 'place_of_worship', 'grave_yard', 'shelter', 'bank', 'embassy', 'fuel', 'bus_station', 'prison', 'university', 'school', 'college', 'kindergarten', 'hospital', 'pharmacy', 'doctors', 'dentist', 'atm', 'bicycle_rental', 'car_sharing', 'post_box', 'post_office', 'recycling', 'telephone', 'emergency_phone', 'toilets', 'drinking_water')
            OR shop IS NOT NULL 
            OR leisure IN ('swimming_pool', 'water_park', 'miniature_golf', 'golf_course', 'sports_centre', 'stadium', 'track', 'pitch', 'playground', 'park', 'recreation_ground', 'common', 'garden', 'nature_reserve', 'marina', 'slipway')
            OR landuse IN ('reservoir', 'basin', 'recreation_ground', 'conservation', 'village_green', 'quarry', 'vineyard', 'orchard', 'cemetery', 'residential', 'garages', 'meadow', 'grass', 'allotments', 'forest', 'farmyard', 'farm', 'farmland', 'retail', 'industrial', 'railway', 'commercial', 'brownfield', 'landfill', 'construction', 'military')
            OR man_made IN ('lighthouse', 'windmill', 'mast', 'water_tower')
            OR "natural" IN ('wood', 'peak', 'volcano', 'saddle', 'cave_entrance', 'water', 'lake', 'mud', 'wetland', 'marsh', 'bay', 'spring', 'scree', 'shingle', 'bare_rock', 'sand', 'heath', 'grassland', 'scrub', 'beach', 'glacier')
            OR place IN ('island', 'islet')
            OR military IN ('danger_area')
            OR historic IN ('memorial', 'archaeological_site')
            OR highway IN ('services', 'rest_area', 'bus_stop', 'ford')
            OR power IN ('station', 'generator', 'sub_station', 'substation')
            OR boundary IN ('national_park')
          ORDER BY way_area desc
        ) AS text_poly
    properties:
      minzoom: 10
    advanced: {}
  - id: "text"
    name: "text"
    class: "text"
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 66
      table: |-
              (SELECT
                way,
                NULL AS way_pixels,
                COALESCE(
                  'aeroway_' || CASE WHEN aeroway IN ('gate', 'apron', 'helipad', 'aerodrome') THEN aeroway ELSE NULL END,
                  'tourism_' || CASE WHEN tourism IN ('alpine_hut', 'hotel', 'motel', 'hostel', 'chalet', 'guest_house', 'camp_site', 'caravan_site', 'theme_park', 'museum', 'attraction', 'zoo', 'information', 'viewpoint', 'picnic_site') THEN tourism ELSE NULL END,
                  'amenity_' || CASE WHEN amenity IN ('pub', 'restaurant', 'food_court', 'cafe', 'fast_food', 'biergarten', 'bar', 'library', 'theatre', 'courthouse', 'townhall', 'cinema', 'parking', 'police', 'fire_station', 'place_of_worship', 'grave_yard', 'shelter', 'bank', 'embassy', 'fuel', 'bus_station', 'prison', 'university', 'school', 'college', 'kindergarten', 'hospital', 'pharmacy', 'doctors', 'dentist', 'atm', 'bicycle_rental', 'car_sharing', 'post_box', 'post_office', 'recycling', 'telephone', 'emergency_phone', 'toilets', 'drinking_water') THEN amenity ELSE NULL END,
                  'shop_' || CASE WHEN shop IN ('supermarket', 'bakery', 'butcher', 'clothes', 'fashion', 'convenience', 'department_store', 'doityourself', 'florist', 'hairdresser', 'car', 'car_repair', 'bicycle', 'mall') THEN shop WHEN shop IN ('accessories', 'alcohol', 'antique', 'antiques', 'appliance', 'art', 'baby_goods', 'bag', 'bags', 'bakery', 'bathroom_furnishing', 'beauty', 'bed', 'betting', 'beverages', 'bicycle', 'boat', 'bookmaker', 'books', 'boutique', 'builder', 'building_materials', 'butcher', 'camera', 'car', 'car_parts', 'car_repair', 'car_service', 'carpet', 'charity', 'cheese', 'chemist', 'chocolate', 'clothes', 'coffee', 'communication', 'computer', 'confectionery', 'convenience', 'copyshop', 'cosmetics', 'craft', 'curtain', 'dairy', 'deli', 'delicatessen', 'department_store', 'discount', 'dive', 'doityourself', 'dry_cleaning', 'e-cigarette', 'electrical', 'electronics', 'energy', 'erotic', 'estate_agent', 'fabric', 'farm', 'fashion', 'fish', 'fishing', 'fishmonger', 'flooring', 'florist', 'food', 'frame', 'frozen_food', 'funeral_directors', 'furnace', 'furniture', 'gallery', 'gambling', 'games', 'garden_centre', 'gas', 'general', 'gift', 'glaziery', 'greengrocer', 'grocery', 'hairdresser', 'hardware', 'health', 'health_food', 'hearing_aids', 'herbalist', 'hifi', 'hobby', 'household', 'houseware', 'hunting', 'ice_cream', 'insurance', 'interior_decoration', 'jewellery', 'jewelry', 'kiosk', 'kitchen', 'laundry', 'leather', 'lighting', 'locksmith', 'lottery', 'mall', 'market', 'massage', 'medical', 'medical_supply', 'mobile_phone', 'money_lender', 'motorcycle', 'motorcycle_repair', 'music', 'musical_instrument', 'newsagent', 'office_supplies', 'optician', 'organic', 'outdoor', 'paint', 'pastry', 'pawnbroker', 'perfumery', 'pet', 'pets', 'pharmacy', 'phone', 'photo', 'photo_studio', 'photography', 'pottery', 'printing', 'radiotechnics', 'real_estate', 'religion', 'rental', 'salon', 'scuba_diving', 'seafood', 'second_hand', 'sewing', 'shoe_repair', 'shoes', 'shopping_centre', 'solarium', 'souvenir', 'sports', 'stationery', 'supermarket', 'tailor', 'tanning', 'tattoo', 'tea', 'ticket', 'tiles', 'tobacco', 'toys', 'trade', 'travel_agency', 'tyres', 'vacuum_cleaner', 'variety_store', 'video', 'video_games', 'watches', 'wholesale', 'wine', 'winery', 'yes') THEN 'other' ELSE NULL END,
                  'leisure_' || CASE WHEN leisure IN ('swimming_pool', 'water_park', 'miniature_golf', 'golf_course', 'sports_centre', 'stadium', 'track', 'pitch', 'playground', 'park', 'recreation_ground', 'common', 'garden', 'nature_reserve', 'marina', 'slipway') THEN leisure ELSE NULL END,
                  'landuse_' || CASE WHEN landuse IN ('reservoir', 'basin', 'recreation_ground', 'conservation', 'village_green', 'quarry', 'vineyard', 'orchard', 'cemetery', 'residential', 'garages', 'meadow', 'grass', 'allotments', 'forest', 'farmyard', 'farm', 'farmland', 'retail', 'industrial', 'railway', 'commercial', 'brownfield', 'landfill', 'construction', 'military') THEN landuse ELSE NULL END,
                  'man_made_' || CASE WHEN man_made IN ('lighthouse', 'windmill', 'mast', 'water_tower') THEN man_made ELSE NULL END,
                  'natural_' || CASE WHEN "natural" IN ('wood', 'peak', 'volcano', 'saddle', 'cave_entrance', 'water', 'lake', 'mud', 'wetland', 'marsh', 'bay', 'spring', 'scree', 'shingle', 'bare_rock', 'sand', 'heath', 'grassland', 'scrub', 'beach', 'glacier') THEN "natural" ELSE NULL END,
                  'place_' || CASE WHEN place IN ('island', 'islet') THEN place ELSE NULL END,
                  'military_' || CASE WHEN military IN ('danger_area') THEN military ELSE NULL END,
                  'historic_' || CASE WHEN historic IN ('memorial', 'archaeological_site') THEN historic ELSE NULL END,
                  'highway_' || CASE WHEN highway IN ('services', 'rest_area', 'bus_stop', 'ford') THEN highway ELSE NULL END,
                  'power_' || CASE WHEN power IN ('station', 'generator', 'sub_station', 'substation') THEN power ELSE NULL END,
                  'boundary_' || CASE WHEN boundary IN ('national_park') THEN boundary ELSE NULL END,
                  'waterway_' || CASE WHEN waterway IN ('lock') THEN waterway ELSE NULL END
                ) AS feature,
                access,
                (CASE WHEN "natural" IN ('peak', 'volcano', 'saddle') OR tourism = 'alpine_hut' OR amenity = 'shelter' THEN CASE WHEN ele IS NOT NULL THEN CASE WHEN name IS NOT NULL THEN CONCAT(name, '\n', ele) ELSE ele END ELSE name END ELSE name END) AS name,
                ref,
                NULL AS way_area,
                CASE WHEN building = 'no' OR building IS NULL THEN 'no' ELSE 'yes' END AS is_building
              FROM planet_osm_point
              WHERE aeroway IN ('gate', 'apron', 'helipad', 'aerodrome')
                OR tourism IN ('alpine_hut', 'hotel', 'motel', 'hostel', 'chalet', 'guest_house', 'camp_site', 'caravan_site', 'theme_park', 'museum', 'attraction', 'zoo', 'information', 'viewpoint', 'picnic_site')
                OR amenity IN ('pub', 'restaurant', 'food_court', 'cafe', 'fast_food', 'biergarten', 'bar', 'library', 'theatre', 'courthouse', 'townhall', 'cinema', 'parking', 'police', 'fire_station', 'place_of_worship', 'grave_yard', 'shelter', 'bank', 'embassy', 'fuel', 'bus_station', 'prison', 'university', 'school', 'college', 'kindergarten', 'hospital', 'pharmacy', 'doctors', 'dentist', 'atm', 'bicycle_rental', 'car_sharing', 'post_box', 'post_office', 'recycling', 'telephone', 'emergency_phone', 'toilets', 'drinking_water')
                OR shop IS NOT NULL 
                OR leisure IN ('swimming_pool', 'water_park', 'miniature_golf', 'golf_course', 'sports_centre', 'stadium', 'track', 'pitch', 'playground', 'park', 'recreation_ground', 'common', 'garden', 'nature_reserve', 'marina', 'slipway')
                OR landuse IN ('reservoir', 'basin', 'recreation_ground', 'conservation', 'village_green', 'quarry', 'vineyard', 'orchard', 'cemetery', 'residential', 'garages', 'meadow', 'grass', 'allotments', 'forest', 'farmyard', 'farm', 'farmland', 'retail', 'industrial', 'railway', 'commercial', 'brownfield', 'landfill', 'construction', 'military')
                OR man_made IN ('lighthouse', 'windmill', 'mast', 'water_tower')
                OR "natural" IN ('wood', 'peak', 'volcano', 'saddle', 'cave_entrance', 'water', 'lake', 'mud', 'wetland', 'marsh', 'bay', 'spring', 'scree', 'shingle', 'bare_rock', 'sand', 'heath', 'grassland', 'scrub', 'beach', 'glacier')
                OR place IN ('island', 'islet')
                OR military IN ('danger_area')
                OR historic IN ('memorial', 'archaeological_site')
                OR highway IN ('bus_stop', 'services', 'rest_area', 'bus_stop', 'ford')
                OR power IN ('station', 'generator', 'sub_station', 'substation')
                OR boundary IN ('national_park')
                OR waterway = 'lock'
              ) AS text
    properties:
      minzoom: 10
    advanced: {}
  - id: "building-text"
    name: "building-text"
    class: ""
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 67
      table: |-
        (SELECT name, way, way_area/(!pixel_width!*!pixel_height!) AS way_pixels
        FROM planet_osm_polygon
        WHERE building IS NOT NULL AND building NOT IN ('no', 'station', 'supermarket')
        ORDER BY way_area DESC
        ) AS building_text
    properties:
      minzoom: 14
    advanced: {}
  - id: "interpolation"
    name: "interpolation"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 68
      table: |-
        (SELECT way
        FROM planet_osm_line
        WHERE "addr:interpolation" IS NOT NULL) AS interpolation
    properties:
      minzoom: 17
    advanced: {}
  - id: "housenumbers"
    name: "housenumbers"
    class: ""
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 69
      table: |-
              (SELECT way,"addr:housenumber", way_area/(!pixel_width!*!pixel_height!) FROM planet_osm_polygon WHERE "addr:housenumber" IS NOT NULL AND building IS NOT NULL
               UNION
               SELECT way,"addr:housenumber", NULL AS way_area FROM planet_osm_point WHERE "addr:housenumber" IS NOT NULL
               ORDER BY way_area DESC
              ) AS housenumbers
    properties:
      minzoom: 17
    advanced: {}
  - id: "housenames"
    name: "housenames"
    class: ""
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 70
      table: |-
        (SELECT way,"addr:housename", way_area/(!pixel_width!*!pixel_height!) FROM planet_osm_polygon WHERE "addr:housename" IS NOT NULL AND building IS NOT NULL
               UNION
               SELECT way,"addr:housename", NULL AS way_area FROM planet_osm_point WHERE "addr:housename" IS NOT NULL
               ORDER BY way_area DESC
              ) AS housenames
    properties:
      minzoom: 17
    advanced: {}
  - id: "water-lines-text"
    name: "water-lines-text"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 71
      table: |-
              (SELECT way, waterway, lock, name, intermittent, CASE WHEN tunnel IN ('yes', 'culvert') THEN 'yes' ELSE 'no' END AS int_tunnel
              FROM planet_osm_line
              WHERE waterway IN ('weir', 'river', 'canal', 'derelict_canal', 'stream', 'drain', 'ditch', 'wadi')
                AND (tunnel IS NULL or tunnel != 'culvert')
               ORDER BY z_order
              ) AS water_lines_text
    properties:
      minzoom: 13
    advanced: {}
  - id: "ferry-routes-text"
    name: "ferry-routes-text"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 72
      table: |-
        (SELECT
          way, name
          FROM planet_osm_line
          WHERE route = 'ferry'
        ) AS ferry_routes_text
    properties:
      minzoom: 13
    advanced: {}
  - id: "admin-text"
    name: "admin-text"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 73
      table: |-
        (SELECT way, name, admin_level FROM planet_osm_polygon WHERE "boundary" = 'administrative' AND admin_level IN ('0', '1', '2', '3', '4', '5', '6', '7', '8', '9', '10')) AS admin_text
    properties:
      minzoom: 16
    advanced: {}
  - id: "nature-reserve-text"
    name: "nature-reserve-text"
    class: ""
    geometry: "linestring"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 74
      table: |-
        (SELECT way, name, way_area/(!pixel_width!*!pixel_height!) AS way_pixels
          FROM planet_osm_polygon WHERE "boundary" = 'national_park' OR leisure = 'nature_reserve') AS nature_reserve_text
    properties:
      minzoom: 13
    advanced: {}
  - id: "amenity-low-priority"
    name: "amenity-low-priority"
    class: "amenity-low-priority"
    geometry: "point"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 75
      table: |-
        (SELECT way,barrier,highway,railway
              FROM planet_osm_point
              WHERE barrier IN ('bollard', 'gate', 'lift_gate', 'block')
                 OR highway IN ('mini_roundabout')
                 OR railway = 'level_crossing'
              ) AS amenity_low_priority
    properties:
      minzoom: 14
    advanced: {}
  - id: "amenity-low-priority-poly"
    name: "amenity-low-priority-poly"
    class: "amenity-low-priority"
    geometry: "polygon"
    <<: *extents
    Datasource:
      <<: *postds
      idx: 76
      table: |-
        (SELECT way,barrier,highway,railway
              FROM planet_osm_polygon
              WHERE barrier IN ('bollard', 'gate', 'lift_gate', 'block')
                 OR highway IN ('mini_roundabout')
                 OR railway = 'level_crossing'
              ) AS amenity_low_priority_poly
    properties:
      minzoom: 14
    advanced: {}
